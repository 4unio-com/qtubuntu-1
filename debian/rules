#!/usr/bin/make -f
# -*- makefile -*-

export DPKG_GENSYMBOLS_CHECK_LEVEL=4

VERSION := $(shell dpkg-parsechangelog | sed -n -e's/^Version: \(.*\)-[^-]\+/\1/p')
SOURCE := $(shell dpkg-parsechangelog | sed -n -e's/^Source: \(.*\)-gles/\1/p')
ANDROID_DIR = build-android
TMP1_DIR = $(CURDIR)/debian/tmp1

# Don't try this at /home/: It will only work within https://ci-train.ubuntu.com
get-orig-source:
	cp -v ~/silos/$(SILONAME)/$(SOURCE)_$(VERSION).orig.tar.gz \
		$(CURDIR)/$(SOURCE)-gles_$(VERSION).orig.tar.gz

%:
	dh $@

override_dh_clean:
	rm -rf $(TMP1_DIR)
	dh_clean

override_dh_auto_configure:
	mkdir -p $(ANDROID_DIR) && dh_auto_configure -B$(ANDROID_DIR) -- "QMAKE_CXXFLAGS=-DPLATFORM_API_TOUCH" $(CURDIR)

override_dh_auto_build:
	dh_auto_build -B$(ANDROID_DIR)

override_dh_auto_install:
	rm -f debian/*/usr/lib/*/qt5/examples/qtubuntu/qmlscene-ubuntu
	mkdir -p $(TMP1_DIR) && cd $(ANDROID_DIR) && INSTALL_ROOT=$(TMP1_DIR) make install
	cd $(CURDIR)

override_dh_install:
	dh_install --sourcedir=$(TMP1_DIR) -pqtubuntu-android
